<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thynka - Mi Cuenta</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Mantengo todos los estilos CSS que ya tenías */
        :root {
            /* Light Mode Colors */
            --primary: #8b6b47;
            --primary-light: #a3846c;
            --primary-dark: #6b5538;
            --cream: #f8f5f2;
            --beige: #f0e6dc;
            --brown: #5a4032;
            --gray: #9a9a9a;
            --white: #ffffff;
            --shadow: rgba(107, 85, 56, 0.1);
            --shadow-hover: rgba(107, 85, 56, 0.15);
            --text-primary: #5a4032;
            --text-secondary: #9a9a9a;
            --bg-primary: #f8f5f2;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0e6dc;
            --border-color: #f0e6dc;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
        }

        [data-theme="dark"] {
            /* Dark Mode Colors */
            --primary: #a3846c;
            --primary-light: #c0a686;
            --primary-dark: #8b6b47;
            --cream: #2a2520;
            --beige: #3a342e;
            --brown: #e0d5c7;
            --gray: #a89b8b;
            --white: #1a1815;
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-hover: rgba(0, 0, 0, 0.4);
            --text-primary: #e0d5c7;
            --text-secondary: #a89b8b;
            --bg-primary: #1a1815;
            --bg-secondary: #2a2520;
            --bg-tertiary: #3a342e;
            --border-color: #3a342e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            right: 20px;
            top: 20px;
            width: 45px;
            height: 45px;
            background-color: var(--primary);
            border: none;
            border-radius: 12px;
            color: var(--white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 1002;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .theme-toggle:hover {
            background-color: var(--primary-dark);
            transform: scale(1.05);
        }

        /* Sidebar Menu */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 280px;
            background-color: var(--bg-secondary);
            box-shadow: 2px 0 15px var(--shadow);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 9999;
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .menu-toggle {
            position: fixed;
            left: 20px;
            top: 20px;
            width: 45px;
            height: 45px;
            background-color: var(--primary);
            border: none;
            border-radius: 12px;
            color: var(--white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 10000;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .menu-toggle:hover {
            background-color: var(--primary-dark);
            transform: scale(1.05);
        }

        .menu-toggle.active {
            left: 300px;
            background-color: var(--bg-secondary);
            color: var(--primary);
        }

        .sidebar-header {
            padding: 30px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar-owl {
            width: 40px;
            height: 40px;
        }

        .sidebar-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--primary-dark);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: block;
            padding: 15px 25px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-weight: 400;
        }

        .menu-item:hover {
            background-color: var(--bg-tertiary);
            border-left-color: var(--primary);
            padding-left: 30px;
        }

        .menu-item.active {
            background-color: var(--bg-tertiary);
            border-left-color: var(--primary);
            padding-left: 30px;
            color: var(--primary);
            font-weight: 500;
        }

        .menu-item i {
            width: 20px;
            margin-right: 15px;
            text-align: center;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 9998;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Main Content */
        .main-content {
            padding: 80px 20px 40px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Profile Header */
        .profile-header {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px var(--shadow);
        }

        .profile-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 30px;
            position: relative;
            z-index: 2;
        }

        .profile-avatar-container {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .profile-avatar-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-dark), var(--primary-light));
            padding: 4px;
        }

        .profile-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 600;
            color: var(--primary);
            overflow: hidden;
            position: relative;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-avatar-edit {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 35px;
            height: 35px;
            background-color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .profile-avatar-edit:hover {
            background-color: var(--primary-dark);
            transform: scale(1.1);
        }

        .profile-details {
            flex: 1;
            color: var(--white);
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .profile-email {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .profile-status {
            display: inline-block;
            padding: 6px 15px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .profile-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--white);
            color: var(--primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--white);
            border: 2px solid var(--white);
        }

        .btn-secondary:hover {
            background-color: var(--white);
            color: var(--primary);
        }

        /* Content Sections */
        .content-sections {
            display: grid;
            gap: 30px;
        }

        .section-card {
            background-color: var(--bg-secondary);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px var(--shadow);
            transition: all 0.3s ease;
        }

        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px var(--shadow-hover);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            color: var(--primary);
        }

        /* Stats Overview */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: var(--white);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(139, 107, 71, 0.3);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Learning Style Section */
        .learning-modes {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--bg-tertiary);
        }

        .learning-modes::-webkit-scrollbar {
            height: 8px;
        }

        .learning-modes::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        .learning-modes::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .learning-mode {
            min-width: 150px;
            padding: 20px;
            background-color: var(--bg-tertiary);
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .learning-mode:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px var(--shadow);
        }

        .learning-mode.active {
            border-color: var(--primary);
            background-color: var(--primary);
            color: var(--white);
        }

        .learning-mode i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .learning-mode span {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Mental State Section */
        .mental-state-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .mental-state-card {
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .mental-state-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow);
        }

        .mental-state-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(139, 107, 71, 0.05) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .mental-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }

        .mental-state-icon.energy { color: var(--success); }
        .mental-state-icon.focus { color: var(--info); }
        .mental-state-icon.motivation { color: var(--warning); }
        .mental-state-icon.stress { color: var(--danger); }

        .mental-state-label {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
            position: relative;
            z-index: 2;
        }

        .mental-state-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }

        .mental-state-value.high { color: var(--success); }
        .mental-state-value.medium { color: var(--warning); }
        .mental-state-value.low { color: var(--danger); }

        .mental-state-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
            position: relative;
            z-index: 2;
        }

        .mental-state-progress {
            width: 100%;
            height: 8px;
            background-color: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 15px;
            position: relative;
            z-index: 2;
        }

        .mental-state-progress-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        .mental-state-progress-bar.energy { background: linear-gradient(90deg, var(--success), #2ecc71); }
        .mental-state-progress-bar.focus { background: linear-gradient(90deg, var(--info), #5dade2); }
        .mental-state-progress-bar.motivation { background: linear-gradient(90deg, var(--warning), #f5b041); }
        .mental-state-progress-bar.stress { background: linear-gradient(90deg, var(--danger), #ec7063); }

        /* Evolution Timeline */
        .evolution-timeline {
            position: relative;
            padding: 20px 0;
            max-height: 500px;
            overflow-y: auto;
        }

        .evolution-timeline::-webkit-scrollbar {
            width: 8px;
        }

        .evolution-timeline::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        .evolution-timeline::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .evolution-timeline::before {
            content: '';
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary);
            transform: translateX(-50%);
        }

        .evolution-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 30px;
            position: relative;
        }

        .evolution-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            flex-shrink: 0;
            margin-right: 20px;
            box-shadow: 0 5px 15px rgba(139, 107, 71, 0.3);
            z-index: 2;
        }

        .evolution-content {
            flex: 1;
            background-color: var(--bg-tertiary);
            padding: 20px;
            border-radius: 15px;
            position: relative;
        }

        .evolution-content::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 20px;
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 10px solid var(--bg-tertiary);
        }

        .evolution-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .evolution-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .evolution-description {
            font-size: 0.95rem;
            color: var(--text-primary);
            line-height: 1.5;
        }

        .evolution-badge {
            display: inline-block;
            padding: 4px 10px;
            background-color: var(--primary);
            color: var(--white);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Personal Limits */
        .limits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .limit-card {
            background-color: var(--bg-tertiary);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .limit-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow);
        }

        .limit-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .limit-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .limit-title i {
            color: var(--primary);
            font-size: 1.2rem;
        }

        .limit-toggle {
            position: relative;
            width: 50px;
            height: 26px;
            background-color: var(--gray);
            border-radius: 13px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .limit-toggle.active {
            background-color: var(--primary);
        }

        .limit-toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background-color: var(--white);
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .limit-toggle.active::after {
            transform: translateX(24px);
        }

        .limit-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .limit-config {
            background-color: var(--bg-secondary);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .limit-config.show {
            display: block;
        }

        .config-group {
            margin-bottom: 15px;
        }

        .config-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: block;
        }

        .config-input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .config-input:focus {
            outline: none;
            border-color: var(--primary);
            background-color: var(--white);
        }

        .time-range {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .day-btn {
            padding: 8px;
            background-color: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .day-btn:hover {
            background-color: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .day-btn.selected {
            background-color: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        /* Motivation Letter */
        .motivation-coffer {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            border-radius: 20px;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }

        .coffer-lid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            border-radius: 20px 20px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 3;
        }

        .coffer-lid:hover {
            height: 70px;
        }

        .coffer-lid.locked {
            background: linear-gradient(135deg, var(--danger), #c0392b);
        }

        .coffer-lock {
            font-size: 2rem;
            color: var(--white);
            transition: transform 0.3s ease;
        }

        .coffer-lid:hover .coffer-lock {
            transform: rotate(10deg);
        }

        .coffer-content {
            margin-top: 60px;
            padding: 20px;
            background-color: var(--bg-secondary);
            border-radius: 0 0 15px 15px;
            min-height: 300px;
        }

        .letter-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input, .form-textarea {
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            background-color: var(--white);
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .letter-display {
            padding: 20px;
            background-color: var(--bg-tertiary);
            border-radius: 15px;
            font-style: italic;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .letter-date {
            text-align: right;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 15px;
        }

        /* Guest Warning */
        .guest-warning {
            background: linear-gradient(135deg, var(--warning), #e67e22);
            color: var(--white);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.3);
        }

        .guest-warning i {
            font-size: 2rem;
        }

        .guest-warning-content {
            flex: 1;
        }

        .guest-warning-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .guest-warning-text {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 10001;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--bg-secondary);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background-color: var(--bg-tertiary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background-color: var(--primary);
            color: var(--white);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 20px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .profile-info {
                flex-direction: column;
                text-align: center;
            }

            .profile-actions {
                justify-content: center;
            }

            .mental-state-grid {
                grid-template-columns: 1fr;
            }

            .limits-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Menu -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <svg class="sidebar-owl" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="sidebarOwlGradient" cx="50%" cy="40%">
                            <stop offset="0%" style="stop-color:#a3846c;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#8b6b47;stop-opacity:1" />
                        </radialGradient>
                    </defs>
                    <ellipse cx="100" cy="110" rx="65" ry="75" fill="url(#sidebarOwlGradient)"/>
                    <circle cx="75" cy="85" r="25" fill="#f0e6dc"/>
                    <circle cx="125" cy="85" r="25" fill="#f0e6dc"/>
                    <circle cx="75" cy="85" r="18" fill="#5a4032"/>
                    <circle cx="125" cy="85" r="18" fill="#5a4032"/>
                    <circle cx="75" cy="85" r="10" fill="#2c2416"/>
                    <circle cx="125" cy="85" r="10" fill="#2c2416"/>
                    <path d="M 100 95 L 90 105 L 100 108 L 110 105 Z" fill="#d4a574"/>
                </svg>
                <h2 class="sidebar-title">Thynka</h2>
            </div>
        </div>
        <div class="sidebar-menu">
            <a href="dashboard.html" class="menu-item">
                <i class="fas fa-home"></i>
                Dashboard
            </a>
            <a href="cuenta.html" class="menu-item active">
                <i class="fas fa-user"></i>
                Cuenta
            </a>
            <a href="tareas.html" class="menu-item">
                <i class="fas fa-tasks"></i>
                Tareas
            </a>
            <a href="horario.html" class="menu-item">
                <i class="fas fa-calendar-alt"></i>
                Horario
            </a>
            <a href="examen.html" class="menu-item">
                <i class="fas fa-file-alt"></i>
                Exámenes
            </a>
            <a href="asistente.html" class="menu-item">
                <i class="fas fa-robot"></i>
                Asistente IA
            </a>
            <a href="recomendaciones.html" class="menu-item">
                <i class="fas fa-graduation-cap"></i>
                Aprende a estudiar
            </a>
            <a href="cuestionarios.html" class="menu-item">
                <i class="fas fa-question-circle"></i>
                Cuestionarios
            </a>
            <a href="patron.html" class="menu-item">
                <i class="fas fa-chart-line"></i>
                Análisis patrones
            </a>
        </div>
    </nav>

    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Profile Header -->
        <section class="profile-header">
            <div class="profile-info">
                <div class="profile-avatar-container">
                    <div class="profile-avatar-bg">
                        <div class="profile-avatar" id="profileAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <div class="profile-avatar-edit" id="avatarEditBtn">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <div class="profile-details">
                    <h1 class="profile-name" id="profileName">Usuario</h1>
                    <div class="profile-email" id="profileEmail">usuario@ejemplo.com</div>
                    <div class="profile-status">
                        <i class="fas fa-circle" style="font-size: 0.8rem; margin-right: 5px;"></i>
                        <span id="profileStatus">Activo</span>
                    </div>
                    <div class="profile-actions">
                        <button class="btn btn-primary" id="editProfileBtn">
                            <i class="fas fa-edit"></i>
                            Editar Perfil
                        </button>
                        <button class="btn btn-secondary" id="accountOptionsBtn">
                            <i class="fas fa-cog"></i>
                            Opciones
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalTasksStat">0</div>
                <div class="stat-label">Tareas Completadas</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="studyHoursStat">0h</div>
                <div class="stat-label">Horas de Estudio</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="streakStat">0</div>
                <div class="stat-label">Días Seguidos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="achievementsStat">0</div>
                <div class="stat-label">Logros</div>
            </div>
        </div>

        <!-- Content Sections -->
        <div class="content-sections">
            <!-- Learning Style Section -->
            <section class="section-card">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-brain"></i>
                        Identidad Cognitiva
                    </h2>
                    <button class="btn btn-primary" id="saveLearningStyle">
                        <i class="fas fa-save"></i>
                        Guardar
                    </button>
                </div>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    ¿Cómo aprendes mejor? Selecciona tus estilos de aprendizaje preferidos:
                </p>
                <div class="learning-modes" id="learningModes">
                    <div class="learning-mode" data-style="visual" data-keyword="VISUAL_LEARNING">
                        <i class="fas fa-eye"></i>
                        <span>Visual</span>
                    </div>
                    <div class="learning-mode" data-style="auditivo" data-keyword="AUDITORY_LEARNING">
                        <i class="fas fa-headphones"></i>
                        <span>Auditivo</span>
                    </div>
                    <div class="learning-mode" data-style="kinestesico" data-keyword="KINESTHETIC_LEARNING">
                        <i class="fas fa-hand-paper"></i>
                        <span>Kinestésico</span>
                    </div>
                    <div class="learning-mode" data-style="lectura" data-keyword="READING_LEARNING">
                        <i class="fas fa-book"></i>
                        <span>Lectura</span>
                    </div>
                    <div class="learning-mode" data-style="logico" data-keyword="LOGICAL_LEARNING">
                        <i class="fas fa-calculator"></i>
                        <span>Lógico</span>
                    </div>
                    <div class="learning-mode" data-style="social" data-keyword="SOCIAL_LEARNING">
                        <i class="fas fa-users"></i>
                        <span>Social</span>
                    </div>
                    <div class="learning-mode" data-style="solitario" data-keyword="SOLITARY_LEARNING">
                        <i class="fas fa-user-graduate"></i>
                        <span>Solitario</span>
                    </div>
                </div>
            </section>

            <!-- Mental State Section -->
            <section class="section-card">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-heartbeat"></i>
                        Estado Mental (Automático)
                    </h2>
                    <button class="btn btn-primary" id="refreshMentalState">
                        <i class="fas fa-sync-alt"></i>
                        Actualizar
                    </button>
                </div>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    Tu estado mental se calcula automáticamente basado en tu actividad diaria:
                </p>
                <div class="mental-state-grid">
                    <div class="mental-state-card">
                        <div class="mental-state-icon energy">
                            <i class="fas fa-battery-three-quarters"></i>
                        </div>
                        <div class="mental-state-label">Energía</div>
                        <div class="mental-state-value" id="energyValue">85%</div>
                        <div class="mental-state-description">
                            Basado en las horas de estudio hoy
                        </div>
                        <div class="mental-state-progress">
                            <div class="mental-state-progress-bar energy" id="energyBar" style="width: 85%;"></div>
                        </div>
                    </div>
                    <div class="mental-state-card">
                        <div class="mental-state-icon focus">
                            <i class="fas fa-crosshairs"></i>
                        </div>
                        <div class="mental-state-label">Concentración</div>
                        <div class="mental-state-value" id="focusValue">92%</div>
                        <div class="mental-state-description">
                            Completaste todas las tareas programadas
                        </div>
                        <div class="mental-state-progress">
                            <div class="mental-state-progress-bar focus" id="focusBar" style="width: 92%;"></div>
                        </div>
                    </div>
                    <div class="mental-state-card">
                        <div class="mental-state-icon motivation">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="mental-state-label">Motivación</div>
                        <div class="mental-state-value" id="motivationValue">78%</div>
                        <div class="mental-state-description">
                            Buen ritmo entre tareas completadas
                        </div>
                        <div class="mental-state-progress">
                            <div class="mental-state-progress-bar motivation" id="motivationBar" style="width: 78%;"></div>
                        </div>
                    </div>
                    <div class="mental-state-card">
                        <div class="mental-state-icon stress">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="mental-state-label">Estrés</div>
                        <div class="mental-state-value" id="stressValue">25%</div>
                        <div class="mental-state-description">
                            Nivel de estrés bajo, buen equilibrio
                        </div>
                        <div class="mental-state-progress">
                            <div class="mental-state-progress-bar stress" id="stressBar" style="width: 25%;"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Evolution Timeline -->
            <section class="section-card">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Línea de Evolución Mental (Automático)
                    </h2>
                    <button class="btn btn-primary" id="refreshEvolution">
                        <i class="fas fa-sync-alt"></i>
                        Actualizar
                    </button>
                </div>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    La app detecta automáticamente tus logros y progreso:
                </p>
                <div class="evolution-timeline" id="evolutionTimeline">
                    <!-- Los logros se cargarán automáticamente desde localStorage -->
                </div>
            </section>

            <!-- Personal Limits -->
            <section class="section-card">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-shield-alt"></i>
                        Límites Personales
                    </h2>
                    <button class="btn btn-primary" id="saveLimits">
                        <i class="fas fa-save"></i>
                        Guardar Todo
                    </button>
                </div>
                <div class="limits-grid" id="limitsContainer">
                    <!-- Los límites se cargarán aquí -->
                </div>
            </section>

            <!-- Motivation Letter -->
            <section class="section-card">
                <div class="motivation-coffer">
                    <div class="coffer-lid" id="cofferLid">
                        <i class="fas fa-lock coffer-lock" id="cofferLock"></i>
                    </div>
                    <div class="coffer-content">
                        <div class="section-header">
                            <h2 class="section-title" style="color: var(--primary-dark);">
                                <i class="fas fa-envelope-open-text"></i>
                                Carta a tu Yo Futuro
                            </h2>
                        </div>
                        <div id="letterContent">
                            <form class="letter-form" id="letterForm">
                                <div class="form-group">
                                    <label class="form-label">Tu mensaje para el futuro:</label>
                                    <textarea class="form-textarea" id="letterText" placeholder="Escribe una carta motivadora a ti mismo... ¿Qué quieres lograr? ¿Cómo te imaginas en el futuro? ¿Qué consejos te darías?"></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Fecha de apertura:</label>
                                        <input type="date" class="form-input" id="openDate">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Hora de apertura:</label>
                                        <input type="time" class="form-input" id="openTime">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary" style="width: 100%;">
                                    <i class="fas fa-lock"></i>
                                    Cerrar Cofre
                                </button>
                            </form>
                        </div>
                        <div id="letterDisplay" style="display: none;">
                            <div class="letter-display" id="savedLetter">
                                <p id="letterTextDisplay"></p>
                                <div class="letter-date" id="letterOpenDate"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-close" id="closeEditModal">
                <i class="fas fa-times"></i>
            </div>
            <h3 class="modal-title">Editar Perfil</h3>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="form-group">
                        <label class="form-label">Nombre de usuario:</label>
                        <input type="text" class="form-input" id="editName" placeholder="Tu nombre">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Biografía:</label>
                        <textarea class="form-textarea" id="editBio" placeholder="Cuéntanos sobre ti..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL de foto de perfil (opcional):</label>
                        <input type="url" class="form-input" id="editPhotoUrl" placeholder="https://ejemplo.com/tu-foto.jpg">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEdit">Cancelar</button>
                <button class="btn btn-primary" id="saveProfile">
                    <i class="fas fa-save"></i>
                    Guardar Cambios
                </button>
            </div>
        </div>
    </div>

    <!-- Account Options Modal -->
    <div class="modal" id="accountOptionsModal">
        <div class="modal-content">
            <div class="modal-close" id="closeOptionsModal">
                <i class="fas fa-times"></i>
            </div>
            <h3 class="modal-title">Opciones de Cuenta</h3>
            <div class="modal-body">
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <button class="btn btn-primary" id="changeAccountBtn" style="justify-content: flex-start;">
                        <i class="fas fa-exchange-alt"></i>
                        Cambiar de cuenta
                    </button>
                    <button class="btn btn-secondary" id="logoutBtn" style="justify-content: flex-start;">
                        <i class="fas fa-sign-out-alt"></i>
                        Cerrar sesión
                    </button>
                    <button class="btn btn-secondary" id="deleteAccountBtn" style="justify-content: flex-start; background-color: var(--danger); border-color: var(--danger);">
                        <i class="fas fa-trash"></i>
                        Eliminar cuenta
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Versión completa con todas las secciones
        console.log('Iniciando página de cuenta completa...');
        
        // Variables globales
        let userData = {
            learningStyles: [],
            limits: {},
            letter: null,
            stats: {
                totalTasks: 0,
                studyHours: 0,
                streak: 0,
                achievements: 0
            },
            // Nuevas propiedades para la funcionalidad solicitada
            appUsage: {
                lastAccessDate: null,
                consecutiveDays: 0
            },
            achievements: [], // Ahora será un array vacío por defecto
            mentalState: {
                energy: 100,
                focus: 100,
                motivation: 100,
                stress: 0
            },
            evolution: []
        };

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const html = document.documentElement;

        const currentTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', currentTheme);
        updateThemeIcon(currentTheme);

        themeToggle.addEventListener('click', () => {
            const theme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            updateThemeIcon(theme);
        });

        function updateThemeIcon(theme) {
            themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Menu Toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            menuToggle.classList.toggle('active');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            menuToggle.classList.remove('active');
        });

        // Función para registrar el acceso a la aplicación y calcular días seguidos
        function trackAppUsage() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0]; // Formato YYYY-MM-DD
            
            // Si no hay registro de último acceso, creamos uno nuevo
            if (!userData.appUsage.lastAccessDate) {
                userData.appUsage.lastAccessDate = todayStr;
                userData.appUsage.consecutiveDays = 1;
                return;
            }
            
            const lastAccessDate = new Date(userData.appUsage.lastAccessDate);
            const lastAccessStr = lastAccessDate.toISOString().split('T')[0];
            
            // Calculamos la diferencia en días
            const diffTime = Math.abs(today - lastAccessDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                // Es el mismo día, no hacemos nada
                return;
            } else if (diffDays === 1) {
                // Es el día siguiente, incrementamos el contador
                userData.appUsage.consecutiveDays++;
            } else {
                // Han pasado más de un día, reiniciamos el contador
                userData.appUsage.consecutiveDays = 1;
            }
            
            // Actualizamos la fecha de último acceso
            userData.appUsage.lastAccessDate = todayStr;
            
            // Guardamos en localStorage
            saveUserData();
            
            // Actualizamos la UI
            document.getElementById('streakStat').textContent = userData.appUsage.consecutiveDays;
        }

        // Función para leer datos de tareas.html (simulada)
        function loadTasksData() {
            // En una implementación real, esto leería datos de tareas.html
            // Por ahora, simulamos la carga de datos
            
            // Simulamos la carga de tareas completadas
            const completedTasks = parseInt(localStorage.getItem('completedTasks') || '0');
            userData.stats.totalTasks = completedTasks;
            
            // Simulamos la carga de horas de estudio del pomodoro
            const studyHours = parseFloat(localStorage.getItem('studyHours') || '0');
            userData.stats.studyHours = studyHours;
            
            // Actualizamos la UI
            document.getElementById('totalTasksStat').textContent = completedTasks;
            document.getElementById('studyHoursStat').textContent = studyHours + 'h';
        }

        /**
         * Función para añadir un nuevo logro.
         * Esta función es la que se llamaría desde tareas.html o examenes.html
         * cuando un usuario complete una acción que desbloquea un logro.
         * @param {string} name - El nombre del logro.
         * @param {string} description - La descripción del logro.
         * @param {string} source - La página de donde proviene el logro ('tareas.html' o 'examenes.html').
         */
        function addAchievement(name, description, source) {
            const newAchievement = {
                id: Date.now().toString(), // ID único basado en el timestamp
                name: name,
                description: description,
                date: new Date().toISOString(),
                source: source
            };

            // Añadimos el nuevo logro al array de logros del usuario
            userData.achievements.push(newAchievement);
            
            // Actualizamos el contador de logros
            userData.stats.achievements = userData.achievements.length;
            
            // Guardamos los datos actualizados en localStorage
            saveUserData();
            
            // Actualizamos la UI para mostrar el nuevo logro inmediatamente
            updateStats();
            updateEvolutionTimeline();
            
            console.log(`Logro desbloqueado: "${name}" desde ${source}`);
        }

        // Función para cargar logros desde localStorage
        function loadAchievements() {
            // Cargamos los logros desde localStorage. Si no hay, el array permanecerá vacío.
            const savedAchievements = JSON.parse(localStorage.getItem('achievements') || '[]');
            userData.achievements = savedAchievements;
            
            // Actualizamos el contador de logros
            userData.stats.achievements = userData.achievements.length;
            
            // Actualizamos la UI
            updateStats();
            updateEvolutionTimeline();
        }

        // Función para actualizar la línea de evolución con los logros
        function updateEvolutionTimeline() {
            const timeline = document.getElementById('evolutionTimeline');
            
            if (userData.achievements.length === 0) {
                // Si no hay logros, mostramos un mensaje informativo
                timeline.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Aún no tienes logros. ¡Sigue estudiando para desbloquearlos!</p>';
                return;
            }
            
            // Ordenamos los logros por fecha (más reciente primero)
            const sortedAchievements = [...userData.achievements].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            // Generamos el HTML para la línea de tiempo
            timeline.innerHTML = sortedAchievements.map(achievement => {
                const date = new Date(achievement.date);
                const formattedDate = date.toLocaleDateString('es-ES', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                
                const formattedTime = date.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Determinamos el icono según la fuente del logro
                let icon = 'fas fa-trophy';
                if (achievement.source === 'tareas.html') {
                    icon = 'fas fa-tasks';
                } else if (achievement.source === 'examenes.html') {
                    icon = 'fas fa-file-alt';
                }
                
                return `
                    <div class="evolution-item">
                        <div class="evolution-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="evolution-content">
                            <div class="evolution-date">${formattedDate} - ${formattedTime}</div>
                            <div class="evolution-title">${achievement.name}</div>
                            <div class="evolution-description">${achievement.description}</div>
                            <div class="evolution-badge">Logro</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Función para calcular el estado mental basado en la actividad del usuario
        function calculateMentalState() {
            // Obtenemos las horas de estudio de hoy (simulado)
            const studyHoursToday = parseFloat(localStorage.getItem('studyHoursToday') || '0');
            
            // Obtenemos las tareas completadas hoy vs programadas (simulado)
            const completedTasksToday = parseInt(localStorage.getItem('completedTasksToday') || '0');
            const scheduledTasksToday = parseInt(localStorage.getItem('scheduledTasksToday') || '5');
            
            // Obtenemos el tiempo entre tareas (simulado)
            const taskGaps = parseFloat(localStorage.getItem('taskGaps') || '1'); // Promedio de horas entre tareas
            
            // Calculamos la energía (se agota más se acerca a 6 horas)
            const energy = Math.max(0, Math.min(100, 100 - (studyHoursToday / 6) * 100));
            
            // Calculamos la concentración (aumenta si completa todas las tareas)
            const focus = scheduledTasksToday > 0 ? (completedTasksToday / scheduledTasksToday) * 100 : 50;
            
            // Calculamos la motivación (disminuye si hay huecos de más de 2 horas)
            const motivation = Math.max(0, Math.min(100, 100 - (taskGaps / 4) * 50));
            
            // Calculamos el estrés (aumenta más se acerca a 6 horas)
            const stress = Math.min(100, (studyHoursToday / 6) * 100);
            
            // Actualizamos el estado mental en userData
            userData.mentalState = {
                energy: energy,
                focus: focus,
                motivation: motivation,
                stress: stress
            };
            
            // Actualizamos la UI
            updateMentalStateDisplay('energy', energy, `Basado en ${studyHoursToday.toFixed(1)} horas de estudio hoy`);
            updateMentalStateDisplay('focus', focus, `Completaste ${completedTasksToday}/${scheduledTasksToday} tareas`);
            updateMentalStateDisplay('motivation', motivation, `Ritmo de ${taskGaps.toFixed(1)}h entre tareas`);
            updateMentalStateDisplay('stress', stress, `Nivel de estrés basado en carga de trabajo`);
        }

        // Función para actualizar la visualización del estado mental
        function updateMentalStateDisplay(type, value, description) {
            const valueElement = document.getElementById(`${type}Value`);
            const barElement = document.getElementById(`${type}Bar`);
            const card = valueElement.closest('.mental-state-card');
            
            valueElement.textContent = Math.round(value) + '%';
            barElement.style.width = value + '%';
            
            valueElement.className = 'mental-state-value';
            if (value >= 70) {
                valueElement.classList.add('high');
            } else if (value >= 40) {
                valueElement.classList.add('medium');
            } else {
                valueElement.classList.add('low');
            }
            
            card.querySelector('.mental-state-description').textContent = description;
        }

        // Función para guardar los datos del usuario en localStorage
        function saveUserData() {
            localStorage.setItem('userData', JSON.stringify(userData));
            // Guardamos los logros por separado para que otras páginas puedan acceder fácilmente
            localStorage.setItem('achievements', JSON.stringify(userData.achievements));
        }

        // Función directa para crear límites
        function createLimitsDirectly() {
            console.log('Creando límites directamente...');
            
            const limitsContainer = document.getElementById('limitsContainer');
            
            if (!limitsContainer) {
                console.error('No se encontró el contenedor de límites');
                return;
            }
            
            // Definición de límites con palabras clave
            const limits = [
                {
                    id: 'study-hours',
                    keyword: 'STUDY_HOURS_LIMIT',
                    title: 'Límite diario de estudio',
                    icon: 'fas fa-clock',
                    description: 'Máximo de horas de estudio por día',
                    type: 'number',
                    default: 6,
                    min: 1,
                    max: 12
                },
                {
                    id: 'no-tasks-after',
                    keyword: 'NO_TASKS_AFTER_TIME',
                    title: 'Sin tareas después de',
                    icon: 'fas fa-moon',
                    description: 'No mostrar tareas después de esta hora',
                    type: 'time',
                    default: '22:00'
                },
                {
                    id: 'break-reminder',
                    keyword: 'BREAK_REMINDER_INTERVAL',
                    title: 'Recordatorio de descanso',
                    icon: 'fas fa-coffee',
                    description: 'Recordar descansar cada X minutos',
                    type: 'number',
                    default: 120,
                    min: 15,
                    max: 180
                },
                {
                    id: 'focus-time',
                    keyword: 'POMODORO_DURATION',
                    title: 'Tiempo Pomodoro',
                    icon: 'fas fa-stopwatch',
                    description: 'Duración de cada sesión Pomodoro',
                    type: 'number',
                    default: 25,
                    min: 5,
                    max: 60
                },
                {
                    id: 'daily-tasks',
                    keyword: 'DAILY_TASKS_LIMIT',
                    title: 'Límite de tareas diarias',
                    icon: 'fas fa-tasks',
                    description: 'Máximo de tareas nuevas por día',
                    type: 'number',
                    default: 5,
                    min: 1,
                    max: 20
                },
                {
                    id: 'weekend-free',
                    keyword: 'WEEKEND_FREE_MODE',
                    title: 'Fin de semana libre',
                    icon: 'fas fa-umbrella-beach',
                    description: 'Sin notificaciones los fines de semana',
                    type: 'toggle',
                    default: false
                },
                {
                    id: 'study-days',
                    keyword: 'STUDY_DAYS_SELECTION',
                    title: 'Días de estudio',
                    icon: 'fas fa-calendar-week',
                    description: 'Selecciona los días que estudias',
                    type: 'days',
                    default: ['L', 'M', 'X', 'J', 'V']
                },
                {
                    id: 'quiet-hours',
                    keyword: 'QUIET_HOURS_RANGE',
                    title: 'Horas de silencio',
                    icon: 'fas fa-volume-mute',
                    description: 'Sin notificaciones en este rango',
                    type: 'time-range',
                    default: { start: '14:00', end: '16:00' }
                },
                {
                    id: 'energy-threshold',
                    keyword: 'LOW_ENERGY_THRESHOLD',
                    title: 'Umbral de energía baja',
                    icon: 'fas fa-battery-quarter',
                    description: 'Alertar cuando la energía baje de este %',
                    type: 'number',
                    default: 30,
                    min: 10,
                    max: 90
                },
                {
                    id: 'task-duration',
                    keyword: 'MAX_TASK_DURATION',
                    title: 'Duración máxima de tarea',
                    icon: 'fas fa-hourglass-half',
                    description: 'Tiempo máximo para una tarea continua',
                    type: 'number',
                    default: 2,
                    min: 1,
                    max: 8
                },
                {
                    id: 'social-mode',
                    keyword: 'SOCIAL_NOTIFICATIONS',
                    title: 'Modo social',
                    icon: 'fas fa-users',
                    description: 'Permitir notificaciones sociales',
                    type: 'toggle',
                    default: true
                },
                {
                    id: 'auto-schedule',
                    keyword: 'AUTO_SCHEDULE_TASKS',
                    title: 'Programación automática',
                    icon: 'fas fa-robot',
                    description: 'Auto-programar tareas según rendimiento',
                    type: 'toggle',
                    default: false
                }
            ];

            console.log(`Creando ${limits.length} límites...`);
            
            // Generar HTML
            let html = '';
            limits.forEach((limit, index) => {
                console.log(`Creando límite ${index + 1}: ${limit.title}`);
                html += createLimitCard(limit);
            });
            
            // Insertar en el DOM
            limitsContainer.innerHTML = html;
            
            // Asignar eventos inmediatamente
            setTimeout(() => {
                assignLimitEvents();
                console.log('Eventos asignados correctamente');
            }, 100);
        }

        // Crear tarjeta de límite
        function createLimitCard(limit) {
            const isEnabled = userData.limits[limit.id] && userData.limits[limit.id].enabled;
            const config = userData.limits[limit.id] ? userData.limits[limit.id].config : limit.default;
            
            let configHtml = '';
            
            switch (limit.type) {
                case 'number':
                    configHtml = `
                        <div class="limit-config ${isEnabled ? 'show' : ''}" id="config-${limit.id}">
                            <div class="config-group">
                                <label class="config-label">Valor:</label>
                                <input type="number" class="config-input" min="${limit.min}" max="${limit.max}" value="${config}" data-limit="${limit.id}">
                            </div>
                        </div>
                    `;
                    break;
                case 'time':
                    configHtml = `
                        <div class="limit-config ${isEnabled ? 'show' : ''}" id="config-${limit.id}">
                            <div class="config-group">
                                <label class="config-label">Hora:</label>
                                <input type="time" class="config-input" value="${config}" data-limit="${limit.id}">
                            </div>
                        </div>
                    `;
                    break;
                case 'toggle':
                    configHtml = `
                        <div class="limit-config ${isEnabled ? 'show' : ''}" id="config-${limit.id}">
                            <div class="config-group">
                                <label class="config-label">Estado:</label>
                                <select class="config-input" data-limit="${limit.id}">
                                    <option value="true" ${config ? 'selected' : ''}>Activado</option>
                                    <option value="false" ${!config ? 'selected' : ''}>Desactivado</option>
                                </select>
                            </div>
                        </div>
                    `;
                    break;
                case 'days':
                    const days = ['L', 'M', 'X', 'J', 'V', 'S', 'D'];
                    const dayNames = ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'];
                    configHtml = `
                        <div class="limit-config ${isEnabled ? 'show' : ''}" id="config-${limit.id}">
                            <div class="config-group">
                                <label class="config-label">Días:</label>
                                <div class="days-grid">
                                    ${days.map((day, index) => `
                                        <button type="button" class="day-btn ${config.includes(day) ? 'selected' : ''}" data-day="${day}" data-limit="${limit.id}">
                                            ${dayNames[index]}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'time-range':
                    configHtml = `
                        <div class="limit-config ${isEnabled ? 'show' : ''}" id="config-${limit.id}">
                            <div class="config-group">
                                <label class="config-label">Rango de horas:</label>
                                <div class="time-range">
                                    <input type="time" class="config-input" value="${config.start}" data-limit="${limit.id}" data-range="start">
                                    <span>a</span>
                                    <input type="time" class="config-input" value="${config.end}" data-limit="${limit.id}" data-range="end">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            return `
                <div class="limit-card" data-limit-id="${limit.id}" data-keyword="${limit.keyword}">
                    <div class="limit-header">
                        <div class="limit-title">
                            <i class="${limit.icon}"></i>
                            ${limit.title}
                        </div>
                        <div class="limit-toggle ${isEnabled ? 'active' : ''}" data-limit="${limit.id}"></div>
                    </div>
                    <div class="limit-description">${limit.description}</div>
                    ${configHtml}
                </div>
            `;
        }

        // Asignar eventos a los límites
        function assignLimitEvents() {
            console.log('Asignando eventos a los límites...');
            
            // Eventos para los toggles
            document.querySelectorAll('.limit-toggle').forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const limitId = this.dataset.limit;
                    this.classList.toggle('active');
                    
                    // Mostrar/ocultar configuración
                    const configDiv = document.getElementById(`config-${limitId}`);
                    if (configDiv) {
                        configDiv.classList.toggle('show');
                    }
                    
                    // Actualizar userData
                    if (!userData.limits) userData.limits = {};
                    
                    // Obtenemos la palabra clave del límite
                    const limitCard = this.closest('.limit-card');
                    const keyword = limitCard.dataset.keyword;
                    
                    userData.limits[limitId] = {
                        enabled: this.classList.contains('active'),
                        keyword: keyword,
                        config: getLimitConfig(limitId)
                    };
                    
                    console.log(`Límite ${limitId} (${keyword}) actualizado:`, userData.limits[limitId]);
                });
            });
            
            // Eventos para los botones de días
            document.querySelectorAll('.day-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
            
            console.log('Eventos asignados exitosamente');
        }

        // Obtener configuración de un límite
        function getLimitConfig(limitId) {
            const configDiv = document.getElementById(`config-${limitId}`);
            if (!configDiv) return null;
            
            const inputs = configDiv.querySelectorAll('.config-input');
            const config = {};
            
            inputs.forEach(input => {
                if (input.type === 'number') {
                    config[input.dataset.range || 'value'] = parseInt(input.value);
                } else if (input.type === 'time') {
                    config[input.dataset.range || 'value'] = input.value;
                } else if (input.tagName === 'SELECT') {
                    config.value = input.value === 'true';
                }
            });
            
            // Manejar selección de días
            const selectedDays = configDiv.querySelectorAll('.day-btn.selected');
            if (selectedDays.length > 0) {
                config.days = Array.from(selectedDays).map(btn => btn.dataset.day);
            }
            
            return config;
        }

        // Guardar límites
        document.getElementById('saveLimits').addEventListener('click', () => {
            console.log('Guardando límites...');
            
            // Actualizar todos los límites
            document.querySelectorAll('.limit-card').forEach(card => {
                const limitId = card.dataset.limitId;
                const keyword = card.dataset.keyword;
                const toggle = card.querySelector('.limit-toggle');
                const isEnabled = toggle.classList.contains('active');
                
                if (!userData.limits) userData.limits = {};
                userData.limits[limitId] = {
                    enabled: isEnabled,
                    keyword: keyword,
                    config: isEnabled ? getLimitConfig(limitId) : null
                };
            });
            
            // Guardar en localStorage
            saveUserData();
            
            alert('¡Límites personales guardados exitosamente!');
            console.log('Límites guardados:', userData.limits);
        });

        // Learning styles
        document.querySelectorAll('.learning-mode').forEach(mode => {
            mode.addEventListener('click', () => {
                mode.classList.toggle('active');
                
                if (!userData.learningStyles) {
                    userData.learningStyles = [];
                }
                
                const style = mode.dataset.style;
                const keyword = mode.dataset.keyword;
                
                if (mode.classList.contains('active')) {
                    // Verificamos si ya existe este estilo
                    const existingIndex = userData.learningStyles.findIndex(s => s.style === style);
                    
                    if (existingIndex === -1) {
                        // Si no existe, lo añadimos con su palabra clave
                        userData.learningStyles.push({
                            style: style,
                            keyword: keyword
                        });
                    }
                } else {
                    // Si existe, lo eliminamos
                    userData.learningStyles = userData.learningStyles.filter(s => s.style !== style);
                }
            });
        });

        document.getElementById('saveLearningStyle').addEventListener('click', () => {
            saveUserData();
            alert('¡Estilos de aprendizaje guardados!');
        });

        // Update stats display
        function updateStats() {
            if (userData.stats) {
                document.getElementById('totalTasksStat').textContent = userData.stats.totalTasks || 0;
                document.getElementById('studyHoursStat').textContent = (userData.stats.studyHours || 0) + 'h';
                document.getElementById('streakStat').textContent = userData.appUsage.consecutiveDays || 0;
                document.getElementById('achievementsStat').textContent = userData.stats.achievements || 0;
            }
        }

        // Refresh mental state
        document.getElementById('refreshMentalState').addEventListener('click', () => {
            calculateMentalState();
            alert('Estado mental actualizado');
        });

        // Refresh evolution
        document.getElementById('refreshEvolution').addEventListener('click', () => {
            loadAchievements();
            alert('Evolución actualizada');
        });

        // Motivation letter
        const letterForm = document.getElementById('letterForm');
        const cofferLid = document.getElementById('cofferLid');
        const cofferLock = document.getElementById('cofferLock');

        letterForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const text = document.getElementById('letterText').value;
            const date = document.getElementById('openDate').value;
            const time = document.getElementById('openTime').value;
            
            if (text && date && time) {
                const openDateTime = new Date(`${date}T${time}`);
                
                userData.letter = {
                    text,
                    openDateTime: openDateTime.toISOString(),
                    isLocked: true
                };
                
                saveUserData();
                displayLetter(userData.letter);
                alert('¡Carta guardada en el cofre!');
            }
        });

        function displayLetter(letter) {
            const letterContent = document.getElementById('letterContent');
            const letterDisplay = document.getElementById('letterDisplay');
            const savedLetter = document.getElementById('savedLetter');
            const letterTextDisplay = document.getElementById('letterTextDisplay');
            const letterOpenDate = document.getElementById('letterOpenDate');
            
            const now = new Date();
            const openDate = new Date(letter.openDateTime);
            
            if (now >= openDate) {
                cofferLid.classList.remove('locked');
                cofferLock.className = 'fas fa-unlock coffer-lock';
                letterContent.style.display = 'none';
                letterDisplay.style.display = 'block';
                letterTextDisplay.textContent = letter.text;
                letterOpenDate.textContent = `Abierto el ${openDate.toLocaleDateString('es-ES', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })}`;
            } else {
                cofferLid.classList.add('locked');
                cofferLock.className = 'fas fa-lock coffer-lock';
                letterContent.style.display = 'none';
                letterDisplay.style.display = 'none';
                
                const timeLeft = openDate - now;
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                letterContent.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-lock" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
                        <h3 style="color: var(--primary-dark); margin-bottom: 10px;">Cofre Bloqueado</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 10px;">
                            Tu carta estará disponible en:
                        </p>
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary);">
                            ${days} días y ${hours} horas
                        </div>
                        <p style="color: var(--text-secondary); margin-top: 10px; font-size: 0.9rem;">
                            Fecha de apertura: ${openDate.toLocaleDateString('es-ES', {
                                day: 'numeric',
                                month: 'long',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </p>
                    </div>
                `;
            }
        }

        cofferLid.addEventListener('click', () => {
            if (userData.letter && !cofferLid.classList.contains('locked')) {
                const letterContent = document.getElementById('letterContent');
                const letterDisplay = document.getElementById('letterDisplay');
                
                if (letterDisplay.style.display === 'none') {
                    letterContent.style.display = 'none';
                    letterDisplay.style.display = 'block';
                    cofferLock.className = 'fas fa-lock-open coffer-lock';
                } else {
                    letterDisplay.style.display = 'none';
                    letterContent.style.display = 'block';
                    cofferLock.className = 'fas fa-unlock coffer-lock';
                }
            }
        });

        // Profile actions (simplificado)
        document.getElementById('editProfileBtn').addEventListener('click', () => {
            alert('Función de edición de perfil próximamente');
        });

        document.getElementById('accountOptionsBtn').addEventListener('click', () => {
            alert('Opciones de cuenta próximamente');
        });

        document.getElementById('avatarEditBtn').addEventListener('click', () => {
            alert('Cambio de foto próximamente');
        });

        // Modals
        document.getElementById('closeEditModal').addEventListener('click', () => {
            document.getElementById('editProfileModal').classList.remove('active');
        });

        document.getElementById('closeOptionsModal').addEventListener('click', () => {
            document.getElementById('accountOptionsModal').classList.remove('active');
        });

        document.getElementById('cancelEdit').addEventListener('click', () => {
            document.getElementById('editProfileModal').classList.remove('active');
        });

        document.getElementById('changeAccountBtn').addEventListener('click', () => {
            window.location.href = 'inicioseccion.html';
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('isGuest');
            window.location.href = 'inicioseccion.html';
        });

        document.getElementById('deleteAccountBtn').addEventListener('click', () => {
            if (confirm('¿Estás seguro de que quieres eliminar tu cuenta? Esta acción no se puede deshacer.')) {
                alert('Función de eliminación de cuenta próximamente');
            }
        });

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM cargado, inicializando todas las secciones...');
            
            // Cargar datos guardados si existen
            const savedData = localStorage.getItem('userData');
            if (savedData) {
                userData = JSON.parse(savedData);
                console.log('Datos cargados desde localStorage:', userData);
            }
            
            // Registrar el uso de la aplicación y calcular días seguidos
            trackAppUsage();
            
            // Cargar datos de tareas
            loadTasksData();
            
            // Cargar logros (ahora solo lee, no crea)
            loadAchievements();
            
            // Calcular estado mental
            calculateMentalState();
            
            // Actualizar estadísticas
            updateStats();
            
            // Crear límites
            createLimitsDirectly();
            
            // Cargar estilos de aprendizaje guardados
            if (userData.learningStyles) {
                document.querySelectorAll('.learning-mode').forEach(mode => {
                    const style = mode.dataset.style;
                    const isActive = userData.learningStyles.some(ls => ls.style === style);
                    mode.classList.toggle('active', isActive);
                });
            }
            
            // Cargar carta si existe
            if (userData.letter) {
                displayLetter(userData.letter);
            }
            
            // Set minimum date for letter (tomorrow)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('openDate').min = tomorrow.toISOString().split('T')[0];
            
            console.log('Página completamente inicializada');
            console.log('Para simular un logro, abre la consola y escribe:');
            console.log('addAchievement("Nombre del Logro", "Descripción del logro", "tareas.html");');
        });
    </script>
</body>
</html>
